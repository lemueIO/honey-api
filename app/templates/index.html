<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="15">
    <title>Honey Cloud Intelligence</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png?v=2">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png?v=2">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png?v=2">
    <link rel="shortcut icon" href="/static/favicon.ico?v=2">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #0d1117;
            color: #c9d1d9;
        }

        .card {
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            box-shadow: none;
        }

        .card:hover {
            transform: translateY(-2px);
            border-color: #8b949e;
        }

        .card-header {
            background-color: #161b22;
            border-bottom: 1px solid #30363d;
        }

        .stat-card {
            color: #fff;
        }

        /* Keep gradients but adjust opacity or overlay if needed, 
           or leave as is for contrast. */
        .bg-local {
            background: linear-gradient(135deg, #1f6feb, #238636);
        }

        .bg-osint {
            background: linear-gradient(135deg, #238636, #2ea043);
        }

        .bg-blacklist {
            background: linear-gradient(135deg, #da3633, #b62324);
        }

        .bg-whitelist {
            background: linear-gradient(135deg, #d29922, #9e6a03);
        }

        .btn-primary {
            background-color: #238636;
            border-color: #238636;
            color: #ffffff;
        }

        .btn-primary:hover {
            background-color: #2ea043;
            border-color: #2ea043;
        }

        .form-control,
        .form-select {
            background-color: #0d1117;
            border-color: #30363d;
            color: #c9d1d9;
        }

        .form-control:focus,
        .form-select:focus {
            background-color: #0d1117;
            border-color: #58a6ff;
            color: #c9d1d9;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.3);
        }

        .table {
            color: #c9d1d9;
            border-color: #30363d;
        }

        .table-light {
            background-color: #161b22;
            color: #c9d1d9;
            border-bottom: 2px solid #30363d;
        }

        /* Fix for table header cells trying to be light */
        .table thead th {
            background-color: #161b22;
            color: #8b949e;
            border-color: #30363d;
        }

        .table-hover tbody tr:hover {
            background-color: #21262d;
            color: #c9d1d9;
        }

        /* Stats card text need to be readable on gradients - default is white which is fine */
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4"
        style="background-color: #161b22 !important; border-bottom: 1px solid #30363d;">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="/static/logo_bear.png?v=2" alt="Logo" width="30" height="30"
                    class="d-inline-block align-text-top me-2">
                <i class="bi bi-shield-check"></i> Honey Cloud Intelligence
            </a>
            <div class="ms-auto">
                <a href="/logout" class="btn btn-outline-light btn-sm"><i class="bi bi-box-arrow-right"></i> Logout</a>
            </div>
        </div>
    </nav>

    <div class="container pb-5">
        <!-- Stats Row -->
        <div class="row g-4 mb-5 text-center">
            <div class="col-md-3">
                <div class="card stat-card bg-local h-100">
                    <div class="card-body">
                        <h5 class="card-title">Honey Cloud Intelligence IPs</h5>
                        <p class="display-6 fw-bold mb-0">{{ stats.local }}</p>
                        <small>Last 365 Days</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card bg-osint h-100">
                    <div class="card-body">
                        <h5 class="card-title">OSINT IPs</h5>
                        <p class="display-6 fw-bold mb-0">{{ stats.osint }}</p>
                        <small>Last 90 Days</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card bg-blacklist h-100">
                    <div class="card-body">
                        <h5 class="card-title">Blacklist</h5>
                        <p class="display-6 fw-bold mb-0">{{ stats.blacklist }}</p>
                        <small>Permanent</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card bg-whitelist h-100">
                    <div class="card-body">
                        <h5 class="card-title">Whitelist</h5>
                        <p class="display-6 fw-bold mb-0">{{ stats.whitelist }}</p>
                        <small>Permanent</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <!-- API Key Management -->
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header py-3 border-0">
                        <h5 class="mb-0"><i class="bi bi-key-fill text-primary"></i> API Key Management</h5>
                    </div>
                    <div class="card-body">
                        <form action="/api-key/generate" method="post" class="row g-3 mb-4">
                            <div class="col-md-9">
                                <input type="text" name="name" class="form-control"
                                    placeholder="Key Name (e.g. HFish Node 1)" required>
                            </div>
                            <div class="col-md-3">
                                <button type="submit" class="btn btn-primary w-100"><i class="bi bi-plus-circle"></i>
                                    Generate New Key</button>
                            </div>
                        </form>
                        <div class="table-responsive" style="max-height: none;">
                            <table class="table table-hover align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>Name</th>
                                        <th>Key</th>
                                        <th class="text-end">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for key, name in api_keys.items() %}
                                    <tr>
                                        <td class="fw-bold">{{ name }}</td>
                                        <td>
                                            <div class="input-group">
                                                <code class="form-control border-0 py-2"
                                                    style="background-color: #21262d; color: #e1e4e8;">{{ key }}</code>
                                                <button class="btn btn-outline-secondary btn-sm border-0"
                                                    style="background-color: #21262d; color: #8b949e;" type="button"
                                                    onclick="copyToClipboard('{{ key }}', this)">
                                                    <i class="bi bi-clipboard"></i>
                                                </button>
                                            </div>
                                        </td>
                                        <td class="text-end">
                                            <form action="/api-key/delete" method="post"
                                                onsubmit="return confirm('WARNING: Are you sure you want to delete this API key? This action cannot be undone and will break any services using this key.');">
                                                <input type="hidden" name="key" value="{{ key }}">
                                                <button type="submit" class="btn btn-outline-danger btn-sm"><i
                                                        class="bi bi-trash"></i> Delete</button>
                                            </form>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    {% if not api_keys %}
                                    <tr>
                                        <td colspan="3" class="text-center text-muted py-4">No API keys generated</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- List Management -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header py-3 border-0">
                        <h5 class="mb-0"><i class="bi bi-list-stars text-primary"></i> List Management</h5>
                    </div>
                    <div class="card-body">
                        <form action="/list/add" method="post" class="row g-3 mb-4">
                            <div class="col-md-6">
                                <input type="text" name="ip" class="form-control"
                                    placeholder="IP Address (e.g. 1.2.3.4)" required>
                            </div>
                            <div class="col-md-3">
                                <select name="list_type" class="form-select">
                                    <option value="blacklist">Blacklist</option>
                                    <option value="whitelist">Whitelist</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <button type="submit" class="btn btn-primary w-100"><i class="bi bi-plus-circle"></i>
                                    Add Entry</button>
                            </div>
                        </form>

                        <div class="row g-4">
                            <!-- Blacklist Display -->
                            <div class="col-md-6">
                                <div class="p-3 border rounded bg-opacity-10"
                                    style="background-color: #0d1117; border-color: #30363d !important;">
                                    <h6 class="fw-bold mb-3 d-flex justify-content-between align-items-center">
                                        <span><i class="bi bi-shield-slash text-danger"></i> Permanent Blacklist</span>
                                        <span class="badge bg-danger rounded-pill">{{ stats.blacklist }}</span>
                                    </h6>
                                    <div class="table-responsive" style="max-height: 300px;">
                                        <table class="table table-sm table-hover">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>IP</th>
                                                    <th class="text-end">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for ip in blacklist %}
                                                <tr>
                                                    <td class="font-monospace">{{ ip }}</td>
                                                    <td class="text-end">
                                                        <form action="/list/remove" method="post" class="d-inline"
                                                            onsubmit="return confirm('Remove {{ ip }} from blacklist?');">
                                                            <input type="hidden" name="ip" value="{{ ip }}">
                                                            <input type="hidden" name="list_type" value="blacklist">
                                                            <button type="submit"
                                                                class="btn btn-link text-danger p-0"><i
                                                                    class="bi bi-trash"></i></button>
                                                        </form>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                                {% if not blacklist %}
                                                <tr>
                                                    <td colspan="2" class="text-center text-muted py-3">Empty</td>
                                                </tr>
                                                {% endif %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- Whitelist Display -->
                            <div class="col-md-6">
                                <div class="p-3 border rounded bg-opacity-10"
                                    style="background-color: #0d1117; border-color: #30363d !important;">
                                    <h6 class="fw-bold mb-3 d-flex justify-content-between align-items-center">
                                        <span><i class="bi bi-shield-check text-success"></i> Permanent Whitelist</span>
                                        <span class="badge bg-success rounded-pill">{{ stats.whitelist }}</span>
                                    </h6>
                                    <div class="table-responsive" style="max-height: 300px;">
                                        <table class="table table-sm table-hover">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>IP</th>
                                                    <th class="text-end">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for ip in whitelist %}
                                                <tr>
                                                    <td class="font-monospace">{{ ip }}</td>
                                                    <td class="text-end">
                                                        <form action="/list/remove" method="post" class="d-inline"
                                                            onsubmit="return confirm('Remove {{ ip }} from whitelist?');">
                                                            <input type="hidden" name="ip" value="{{ ip }}">
                                                            <input type="hidden" name="list_type" value="whitelist">
                                                            <button type="submit"
                                                                class="btn btn-link text-danger p-0"><i
                                                                    class="bi bi-trash"></i></button>
                                                        </form>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                                {% if not whitelist %}
                                                <tr>
                                                    <td colspan="2" class="text-center text-muted py-3">Empty</td>
                                                </tr>
                                                {% endif %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function copyToClipboard(text, btn) {
            const onSuccess = () => {
                const icon = btn.querySelector('i');
                const originalClass = icon.className;
                icon.className = 'bi bi-check2 text-success';
                setTimeout(() => {
                    icon.className = originalClass;
                }, 2000);
            };

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(onSuccess).catch(err => {
                    console.error('Clipboard error:', err);
                    fallbackCopy(text, onSuccess);
                });
            } else {
                fallbackCopy(text, onSuccess);
            }
        }

        function fallbackCopy(text, callback) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                callback();
            } catch (err) {
                console.error('Fallback copy error:', err);
            }
            document.body.removeChild(textArea);
        }
    </script>
</body>

</html>